# Learn2Grow Email System

This document provides instructions on how to test the recipient registration email flow in the Learn2Grow platform.

## Testing Recipient Registration

1. **Start the server** if it's not already running:
   ```bash
   npm start
   ```

2. **Register as a new recipient**:
   - Go to the registration page in the browser
   - Fill out the registration form with your name, email, and password
   - Submit the form
   - The system will automatically:
     - Store the registration in the database as a pending request
     - Send a confirmation email to the recipient
     - Send a notification to the admin
     - Send a verification email asking for additional documentation

3. **Check your email** for the confirmation and verification messages.

## Manual Email Processing

If you need to manually process emails (e.g., if they weren't sent automatically), you can use the `processEmails.js` script:

```bash
# Process all pending emails in the database
node processEmails.js

# Force reprocessing of all emails, even if they were previously sent
node processEmails.js --force  

# Send verification emails to all pending recipients
node processEmails.js --verify-all

# Process emails for a specific recipient
node processEmails.js --email=recipient@example.com
```

## Scheduled Email Processing

The system includes a scheduler that can automatically process pending emails:

```bash
# Run the scheduler once and exit
node scheduledEmails.js --once

# Run the scheduler continuously (checking every hour by default)
node scheduledEmails.js

# Run the scheduler with a custom interval (e.g., every 5 minutes)
node scheduledEmails.js --interval=5
```

## Email Configuration

The system uses the following environment variables for email configuration:

- `EMAIL_HOST`: SMTP server hostname (default: smtp.gmail.com)
- `EMAIL_PORT`: SMTP server port (default: 587)
- `EMAIL_SECURE`: Whether to use TLS (default: false)
- `EMAIL_USER`: Email address to send from (learn2growad1@gmail.com)
- `EMAIL_PASS`: App password for the email account
- `ADMIN_EMAIL`: Email address for admin notifications (learn2growad1@gmail.com)

These settings are configured in the `.env` file.

## Email Types

The system sends the following types of emails:

1. **Confirmation Email**: Sent to recipients when they register
2. **Admin Notification**: Sent to administrators when new recipients register
3. **Verification Email**: Sent to recipients asking for eligibility documentation
4. **Approval Email**: Sent to recipients when their registration is approved

Each email is tracked in the database to prevent duplicate sending.

## Using PM2 Process Manager (Recommended)

PM2 allows you to run the email processor as a background service that automatically starts when the system boots.

### Installation

```bash
# Install PM2 globally
npm install -g pm2
```

### Managing Services

We've created PowerShell scripts to make it easy to manage services:

```powershell
# Start all services (server and email processor)
./manage-services.ps1 start

# View status of all services
./manage-services.ps1 status

# View logs from all services
./manage-services.ps1 logs

# View only email service logs
./manage-services.ps1 email-logs

# Manually process emails
./manage-services.ps1 email

# Save current process list for auto-restart
./manage-services.ps1 save

# Open PM2 monitoring dashboard
./manage-services.ps1 monit
```

### Processing Individual Emails

For easier email processing during testing or administration:

```powershell
# Process all pending emails
./process-emails.ps1

# Process emails for a specific recipient
./process-emails.ps1 -email user@example.com

# Force resend all emails (even if previously sent)
./process-emails.ps1 -force

# Send verification emails to all pending recipients
./process-emails.ps1 -verifyAll

# Show usage help
./process-emails.ps1 -help
```
